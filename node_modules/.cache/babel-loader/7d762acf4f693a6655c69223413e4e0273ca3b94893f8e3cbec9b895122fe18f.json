{"ast":null,"code":"import React,{useEffect}from\"react\";import styles from\"./order-page.module.css\";import{CurrencyIcon,FormattedDate}from\"@ya.praktikum/react-developer-burger-ui-components\";import{useAppDispatch,useAppSelector}from\"../../services/hooks/hooks\";import{ingredientSelector}from\"../../services/store/selector/ingredientSelector\";import{OrderList}from\"../order-icon/order-icon\";import{useParams}from\"react-router-dom\";import{connect,wsClose}from\"../../services/store/reducers/socket/actions\";import{ORDERS_ALL,fetchOrder}from\"../../utils/api\";import{detailsSelector}from\"../../services/store/selector/detailsSelector\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var OrderPage=function OrderPage(_ref){var _ref$modal=_ref.modal,modal=_ref$modal===void 0?false:_ref$modal;var dispatch=useAppDispatch();var ingredientsData=useAppSelector(ingredientSelector);var _useParams=useParams(),number=_useParams.id;console.log(number);var orderData=useAppSelector(detailsSelector);console.log(orderData);var orderIngredients=orderData&&orderData.ingredients;var order=orderData&&orderData;function price(item){var totalPrice=0;if(item){item.ingredients.forEach(function(ingrAll){ingredientsData.forEach(function(itemData){if(itemData._id===ingrAll){totalPrice+=itemData.type===\"bun\"?itemData.price*2:itemData.price;}});});}return totalPrice;}useEffect(function(){dispatch(connect(ORDERS_ALL));dispatch(fetchOrder(number));return function(){wsClose();};},[]);var done=order&&order.status===\"done\";return orderData&&/*#__PURE__*/_jsxs(\"section\",{className:\"\".concat(styles.container,\" mt-15 mb-10 mr-10 ml-10\"),children:[/*#__PURE__*/_jsx(\"p\",{className:\"text text_type_digits-default \".concat(!modal&&styles.number),children:\"#\".concat(order.number)}),/*#__PURE__*/_jsx(\"p\",{className:\"text text_type_main-medium mt-10\",children:order.name}),/*#__PURE__*/_jsx(\"p\",{className:\"text text_type_main-default mt-3 \".concat(done&&styles.status),children:done?\"Выполнен\":\"Готовится\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text text_type_main-medium mt-15 mb-6\",children:\"\\u0421\\u043E\\u0441\\u0442\\u0430\\u0432:\"}),/*#__PURE__*/_jsx(OrderList,{ingredients:orderIngredients,shift:false}),/*#__PURE__*/_jsxs(\"div\",{className:\"\".concat(styles.footer,\" mt-10\"),children:[/*#__PURE__*/_jsx(\"p\",{className:\"text text_type_main-default text_color_inactive\",children:/*#__PURE__*/_jsx(FormattedDate,{className:\"text text_type_main-default text_color_inactive\",date:new Date(order.createdAt)})}),/*#__PURE__*/_jsxs(\"div\",{className:styles.total,children:[/*#__PURE__*/_jsx(\"p\",{className:\"text text_type_digits-default mr-2\",children:price(order)}),/*#__PURE__*/_jsx(CurrencyIcon,{type:\"primary\"})]})]})]});};","map":{"version":3,"names":["React","useEffect","styles","CurrencyIcon","FormattedDate","useAppDispatch","useAppSelector","ingredientSelector","OrderList","useParams","connect","wsClose","ORDERS_ALL","fetchOrder","detailsSelector","jsx","_jsx","jsxs","_jsxs","OrderPage","_ref","_ref$modal","modal","dispatch","ingredientsData","_useParams","number","id","console","log","orderData","orderIngredients","ingredients","order","price","item","totalPrice","forEach","ingrAll","itemData","_id","type","done","status","className","concat","container","children","name","shift","footer","date","Date","createdAt","total"],"sources":["C:/Users/Nailusha/Desktop/yandex-dev/react-stellar-burger/src/components/order-page/order-page.tsx"],"sourcesContent":["import React, { FC, useEffect } from \"react\";\r\nimport styles from \"./order-page.module.css\";\r\n\r\nimport {\r\n  CurrencyIcon,\r\n  FormattedDate,\r\n} from \"@ya.praktikum/react-developer-burger-ui-components\";\r\nimport { useAppDispatch, useAppSelector } from \"../../services/hooks/hooks\";\r\nimport { ingredientSelector } from \"../../services/store/selector/ingredientSelector\";\r\nimport { OrderList } from \"../order-icon/order-icon\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport { allOrdersInf } from \"../../services/store/selector/allOrders/allOrders\";\r\nimport { connect, wsClose } from \"../../services/store/reducers/socket/actions\";\r\nimport { ORDERS_ALL, fetchOrder } from \"../../utils/api\";\r\nimport { TingredientType } from \"../../utils/types\";\r\nimport { detailsSelector } from \"../../services/store/selector/detailsSelector\";\r\nimport { TFeedOrder } from \"../../utils/live-table\";\r\n\r\nexport const OrderPage = ({ modal = false }) => {\r\n  const dispatch = useAppDispatch();\r\n  const ingredientsData = useAppSelector(ingredientSelector);\r\n  const { id: number } = useParams();\r\n  console.log(number)\r\n  const orderData = useAppSelector(detailsSelector)\r\n  console.log(orderData)\r\n  const orderIngredients = orderData&&orderData.ingredients;\r\n  const order = orderData && orderData;\r\n\r\n  function price(item: TFeedOrder) {\r\n    let totalPrice = 0;\r\n    if (item) {\r\n      item.ingredients.forEach((ingrAll) => {\r\n        ingredientsData.forEach((itemData: { _id: string; type: string; price: number; }) => {\r\n          if (itemData._id === ingrAll) {\r\n            totalPrice +=\r\n              itemData.type === \"bun\" ? itemData.price * 2 : itemData.price;\r\n          }\r\n        });\r\n      });\r\n    }\r\n    return totalPrice;\r\n  }\r\n\r\n   \r\n\r\n  useEffect(() => {\r\n    dispatch(connect(ORDERS_ALL));\r\n    dispatch(fetchOrder(number));   \r\n\r\n    return () => {\r\n      wsClose();\r\n    };\r\n  }, []);\r\n\r\n  const done = order && order.status === \"done\";\r\n  \r\n\r\n  return (\r\n    orderData &&\r\n    <section className={`${styles.container} mt-15 mb-10 mr-10 ml-10`}>\r\n      <p\r\n        className={`text text_type_digits-default ${!modal && styles.number}`}\r\n      >{`#${order.number}`}</p>\r\n      <p className={\"text text_type_main-medium mt-10\"}>{order.name}</p>\r\n      <p\r\n        className={`text text_type_main-default mt-3 ${done && styles.status}`}\r\n      >\r\n        {done ? \"Выполнен\" : \"Готовится\"}\r\n      </p>\r\n      <p className={\"text text_type_main-medium mt-15 mb-6\"}>Состав:</p>\r\n      <OrderList\r\n        ingredients={orderIngredients}\r\n        shift={false}\r\n      />\r\n      <div className={`${styles.footer} mt-10`}>\r\n        <p className={\"text text_type_main-default text_color_inactive\"}>\r\n          <FormattedDate\r\n            className={\"text text_type_main-default text_color_inactive\"}\r\n            date={new Date(order.createdAt)}\r\n          />\r\n        </p>\r\n        <div className={styles.total}>\r\n          <p className={\"text text_type_digits-default mr-2\"}>{price(order)}</p>\r\n          <CurrencyIcon type=\"primary\" />\r\n        </div>\r\n      </div>\r\n    </section>\r\n  );\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}