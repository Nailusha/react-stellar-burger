{"ast":null,"code":"import _toConsumableArray from\"C:/Users/Nailusha/Desktop/yandex-dev/react-stellar-burger/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import{useEffect,useMemo}from\"react\";import{Link,useLocation}from\"react-router-dom\";import styles from\"./orders.module.css\";import{OrderCard}from\"../../components/order-card/order-card\";import{useAppDispatch,useAppSelector}from\"../../services/hooks/hooks\";import{ingredientSelector}from\"../../services/store/selector/ingredientSelector\";import{allOrdersInf}from\"../../services/store/selector/allOrders/allOrders\";import{connect,wsClose}from\"../../services/store/reducers/socket/actions\";import{ORDERS}from\"../../utils/api\";import{jsx as _jsx}from\"react/jsx-runtime\";export default function OrdersPage(){var dispatch=useAppDispatch();var ordersInf=useAppSelector(allOrdersInf);var ordersData=ordersInf&&ordersInf.orders;var ordersDataReversed=ordersData&&_toConsumableArray(ordersData).reverse()||[];var location=useLocation();console.log(ordersData);var ingredientsData=useAppSelector(ingredientSelector);var accessToken=useMemo(function(){var _localStorage$getItem;return(_localStorage$getItem=localStorage.getItem(\"accessToken\"))===null||_localStorage$getItem===void 0?void 0:_localStorage$getItem.replace(\"Bearer \",\"\");},[localStorage.getItem(\"accessToken\")]);function price(item){var totalPrice=0;if(item){item.ingredients.forEach(function(ingrAll){ingredientsData.forEach(function(itemData){if(itemData._id===ingrAll){totalPrice+=itemData.type===\"bun\"?itemData.price*2:itemData.price;}});});}return totalPrice;}useEffect(function(){dispatch(connect(\"\".concat(ORDERS,\"?token=\").concat(accessToken)));return function(){wsClose();};},[]);return ordersDataReversed&&/*#__PURE__*/_jsx(\"section\",{className:\"\".concat(styles.orders,\" custom-scroll pr-2\"),children:ordersDataReversed.map(function(item){return/*#__PURE__*/_jsx(Link,{className:styles.link,to:\"\".concat(item.number),state:{background:location},children:/*#__PURE__*/_jsx(OrderCard,{ordersData:item,price:price(item)},item._id)},item._id);})});}","map":{"version":3,"names":["useEffect","useMemo","Link","useLocation","styles","OrderCard","useAppDispatch","useAppSelector","ingredientSelector","allOrdersInf","connect","wsClose","ORDERS","jsx","_jsx","OrdersPage","dispatch","ordersInf","ordersData","orders","ordersDataReversed","_toConsumableArray","reverse","location","console","log","ingredientsData","accessToken","_localStorage$getItem","localStorage","getItem","replace","price","item","totalPrice","ingredients","forEach","ingrAll","itemData","_id","type","concat","className","children","map","link","to","number","state","background"],"sources":["C:/Users/Nailusha/Desktop/yandex-dev/react-stellar-burger/src/pages/orders/orders.tsx"],"sourcesContent":["import { FC, useEffect, useMemo } from \"react\";\r\nimport { Link, useLocation } from \"react-router-dom\";\r\nimport styles from \"./orders.module.css\";\r\n\r\nimport { OrderCard } from \"../../components/order-card/order-card\";\r\nimport { useAppDispatch, useAppSelector } from \"../../services/hooks/hooks\";\r\nimport { ingredientSelector } from \"../../services/store/selector/ingredientSelector\";\r\nimport { allOrdersInf } from \"../../services/store/selector/allOrders/allOrders\";\r\nimport { connect, wsClose } from \"../../services/store/reducers/socket/actions\";\r\nimport { ORDERS, ORDERS_ALL } from \"../../utils/api\";\r\nimport { Torder } from \"../../utils/types\";\r\n\r\nexport default function OrdersPage() {\r\n  const dispatch = useAppDispatch();\r\n  const ordersInf = useAppSelector(allOrdersInf);\r\n  const ordersData = ordersInf && ordersInf.orders;\r\n  const ordersDataReversed = (ordersData && [...ordersData].reverse()) || [];\r\n  const location = useLocation();\r\n  console.log(ordersData);\r\n\r\n  const ingredientsData = useAppSelector(ingredientSelector);\r\n\r\n  const accessToken = useMemo(\r\n    () => localStorage.getItem(\"accessToken\")?.replace(\"Bearer \", \"\"),\r\n    [localStorage.getItem(\"accessToken\")]\r\n  );\r\n\r\n  function price(item: Torder) {\r\n    let totalPrice = 0;\r\n    if (item) {\r\n      item.ingredients.forEach((ingrAll) => {\r\n        ingredientsData.forEach((itemData: { _id: string; type: string; price: number; }) => {\r\n          if (itemData._id === ingrAll) {\r\n            totalPrice +=\r\n              itemData.type === \"bun\" ? itemData.price * 2 : itemData.price;\r\n          }\r\n        });\r\n      });\r\n    }\r\n    return totalPrice;\r\n  }\r\n\r\n  useEffect(() => {\r\n    dispatch(connect(`${ORDERS}?token=${accessToken}`));\r\n\r\n    return () => {\r\n      wsClose();\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    ordersDataReversed && (\r\n      <section className={`${styles.orders} custom-scroll pr-2`}>\r\n        {ordersDataReversed.map((item: Torder) => {\r\n          return (\r\n            <Link\r\n              className={styles.link}\r\n              key={item._id}\r\n              to={`${item.number}`}\r\n              state={{ background: location }}\r\n            >\r\n              <OrderCard key={item._id} ordersData={item} price={price(item)} />\r\n            </Link>\r\n          );\r\n        })}\r\n      </section>\r\n    )\r\n  );\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}